---
layout: book
title: Extract Method（提炼函数）
book: refactor
group: composing-methods
---

## What

你有一段代码可以被组织在一起并独立出来。

**将这段代码放进一个独立函数中的，并让函数名称解释该函数的用途。**

**原始代码：**

```java
void printOwing(double amout){
    printBanner();
    
    //print details
    System.out.println("name:" + _name);
    System.out.println("amount:" + _amount);
}
```


**提炼函数：**

```java
void printOwing(double amout){
    printBanner();
    printDetails(amount);
}

void printDetails(double amout){
    System.out.println("name:" + _name);
    System.out.println("amount:" + _amount);
} 
```

## Why

一个**简短而命名良好的函数**有诸多好处：

* 首先，如果每个函数的粒度都很小，那么函数被复用的机会就更大；
* 其次，会使高层（调用）函数读起来就像一系列的注释；
* 再次，如果函数都是细粒度，那么函数的覆写（重写）也会更容易些。

> PS: **简短而命名良好的函数**并不是说函数的名称一定要短，重要是**闻其名，便知其意。**

## When

**Extract Method** 是最常用的重构手法之一，当看到一个**过长的函数**或者一段**需要注释**才能让人理解的代码，就可以将这段代码放进一个独立的函数中。


## How

1. 创建一个新函数，根据这个函数的意图来对它命名（以它"**做什么**"来命名，而不是以它"**怎么做**"命名）。
    
    > 即使你想要提炼的代码非常简单，例如只是一条消息或一个函数调用，只要新函数的名称能够以更好的方式昭示代码意图，你也应该提炼它。但如果你想不出一个更有意义的名称，就别动。
    
2. 将提炼出的代码放进新建的目标函数中。

3. 仔细检查提炼出的代码中是否引用了"**作用域限于源函数**"的变量（包括局部变量和源函数参数）。

4. 检查被提炼的代码段中**是否有任何局部变量的值被它修改**。

    > 如果一个临时变量值被修改了，看看是否可以将提炼代码段处理为一个查询，并将结果赋值给相关变量。
    > 如果很难这样做，或如果被修改的变量不止一个，那么就不能仅仅将这段代码**原封不动**地提炼出来。
    
5. 将被提炼代码段中需要读取的局部变量，当作参数传给目标函数。

6. 处理完所有局部变量之后，进行编译。

7. 在源函数中，将被提炼代码段替换为对目标函数的调用。

8. 编译，测试。
